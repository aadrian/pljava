<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.6 at 2020-10-04 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>PostgreSQL PL/Java &#x2013; Setting byte order in PL/Java 1.5.0 and later</title>
    <style type="text/css" media="all">
      @import url("../css/maven-base.css");
      @import url("../css/maven-theme.css");
      @import url("../css/site.css");
    </style>
    <link rel="stylesheet" href="../css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20201004" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                        <a href="https://tada.github.io/pljava/" id="bannerLeft" title="PL/Java logo combining the PostgreSQL elephant and a Java bean">
                                                <img src="../images/pljava_logo.jpg" alt="PL/Java logo combining the PostgreSQL elephant and a Java bean" />
                </a>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                    
                <div class="xleft">
        <span id="publishDate">Last Published: 2020-10-04</span>
                  &nbsp;| <span id="projectVersion">Version: 1.5.6</span>
                      </div>
            <div class="xright">                    <a href="https://github.com/tada/pljava/wiki/" class="externalLink" title="Wiki">Wiki</a>
            |
                        <a href="https://github.com/tada/pljava/issues" class="externalLink" title="Issues">Issues</a>
            |
                        <a href="https://www.postgresql.org/list/pljava-dev/" class="externalLink" title="Mailing list">Mailing list</a>
            |
                        <a href="https://github.com/tada/pljava/tree/master/" class="externalLink" title="Code">Code</a>
              
                    
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                    
                                <h5>Usage</h5>
                  <ul>
                  <li class="none">
                          <a href="../build/build.html" title="Building PL/Java">Building PL/Java</a>
            </li>
                  <li class="none">
                          <a href="../install/install.html" title="Installing into PostgreSQL">Installing into PostgreSQL</a>
            </li>
                  <li class="none">
                          <a href="../install/upgrade.html" title="Upgrading">Upgrading</a>
            </li>
                  <li class="none">
                          <a href="../build/package.html" title="Packaging PL/Java">Packaging PL/Java</a>
            </li>
                  <li class="none">
                          <a href="../use/use.html" title="User guide">User guide</a>
            </li>
                  <li class="none">
                          <a href="../develop/develop.html" title="Developer notes">Developer notes</a>
            </li>
          </ul>
                       <h5>Release Information</h5>
                  <ul>
                  <li class="none">
                          <a href="../releasenotes.html" title="Release notes">Release notes</a>
            </li>
          </ul>
                       <h5>Modules</h5>
                  <ul>
                  <li class="none">
                          <a href="../pljava-api/index.html" title="PL/Java API">PL/Java API</a>
            </li>
                  <li class="none">
                          <a href="../pljava/index.html" title="PL/Java backend Java code">PL/Java backend Java code</a>
            </li>
                  <li class="none">
                          <a href="../pljava-so/index.html" title="PL/Java backend native code">PL/Java backend native code</a>
            </li>
                  <li class="none">
                          <a href="../pljava-deploy/index.html" title="PL/Java Deploy">PL/Java Deploy</a>
            </li>
                  <li class="none">
                          <a href="../pljava-ant/index.html" title="PL/Java Ant tasks">PL/Java Ant tasks</a>
            </li>
                  <li class="none">
                          <a href="../pljava-examples/index.html" title="PL/Java examples">PL/Java examples</a>
            </li>
                  <li class="none">
                          <a href="../pljava-packaging/index.html" title="PL/Java packaging">PL/Java packaging</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                                                                                                          <li class="collapsed">
                          <a href="../project-info.html" title="Project Information">Project Information</a>
                  </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                   
                    
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <h1>Setting byte order in PL/Java 1.5.0 and later</h1>
<p>The byte order of the system where PostgreSQL is running is a detail mostly invisible in PL/Java, but there are two capabilities of PL/Java where it can matter:</p>

<dl>
<dt>Mirrored types</dt>
<dd>PL/Java allows associating a Java class with any <i>existing</i> PostgreSQL type that does not have a predefined JDBC or PL/Java mapping. The existing type can be either a composite type (a tuple of typed values) or a base type. For a base type, the Java class must be written with knowledge of how PostgreSQL lays out the stored form of the data. The <a class="externalLink" href="https://github.com/tada/pljava/tree/master//pljava-examples/src/main/java/org/postgresql/pljava/example/annotation/Point.java"><tt>Point</tt> example</a> illustrates a mirrored type. <i>If PL/Java uses a different byte order than the underlying system, mirrored types will be visibly broken, having different values seen in PostgreSQL and in Java.</i></dd>
<dt>Base types</dt>
<dd>New PostgreSQL base types can be defined with PL/Java. The <a class="externalLink" href="https://github.com/tada/pljava/tree/master//pljava-examples/src/main/java/org/postgresql/pljava/example/annotation/ComplexScalar.java"><tt>ComplexScalar</tt> example</a> illustrates a PL/Java-defined base type. With a base type, differences between PL/Java byte order and that of the underlying system are less noticeable (because nothing but PL/Java ever touches the type&#x2019;s representation). However, in a database with existing data stored as PL/Java base types, <i>changing</i> PL/Java&#x2019;s byte order will render the data visibly bogus.</dd>
</dl>
<p><i>In older PL/Java versions up to and including <tt>1.5.0-BETA2</tt>, byte order was always big-endian regardless of the underlying system.</i> That means that on little-endian hardware (which is very common), PL/Java <i>mirrored types</i> will have been noticeably broken, and probably seldom used. Base types may have seen more use, and existing databases may have data stored in PL/Java base types using big-endian order.</p>
<p><i>Beginning with PL/Java 1.5.0, byte order is selectable, and has different defaults for base types and mirrored types.</i> For <i>base</i> types, the default remains big-endian, to minimize disruption if a database has legacy data stored that way, and to preserve the binary send/receive/<tt>COPY</tt> format for those types. For <i>mirrored</i> types, the default is changed to native (that is, the same as the underlying system), because nothing else makes much sense for a mirrored type.</p>
<p>At present, all PL/Java base types implicitly have a send/receive/<tt>COPY</tt> binary format reflecting their internal stored format, and are not able to use their <tt>send</tt> and <tt>receive</tt> function slots to define a custom format for binary transfer. Because the <a class="externalLink" href="http://www.postgresql.org/docs/8.2/static/sql-copy.html#AEN46503">binary <tt>COPY</tt> format documentation</a> specifies network byte order (that is, big-endian), there are no plans to change the default stored form from <tt>big_endian</tt> for base types, until some future release decouples the stored representation from that for binary transfer.</p>
<p>In some future release, the default byte order for base types may change, and a site with stored data in PL/Java base types will then need to apply a migration step to the existing data (or keep the big-endian byte order by explicitly selecting it instead of the default). Methods to migrate existing data are covered below.</p>
<div class="section">
<h2><a name="How_to_configure_PLJava_byte_order"></a>How to configure PL/Java byte order</h2>
<p>The byte order is set with Java system properties, which can be specified with the <tt>-D</tt> option within the PostgreSQL configuration setting <tt>pljava.vmoptions</tt>. For example, to set <tt>native</tt> byte order for all uses:</p>

<div class="source">
<div class="source">
<pre>SET pljava.vmoptions TO '-Dorg.postgresql.pljava.udt.byteorder=native`;
</pre></div></div>
<p>The allowable values are <tt>big_endian</tt>, <tt>little_endian</tt>, and <tt>native</tt>.</p>
<p>More-specific properties are available to set the byte order for specific uses, and more-specific ones override less-specific ones:</p>

<div class="source">
<div class="source">
<pre>org.postgresql.pljava.udt.byteorder.scalar
org.postgresql.pljava.udt.byteorder.mirror
</pre></div></div>
<p>Again, for release 1.5.0, the defaults are <tt>big_endian</tt> for <tt>scalar</tt> and <tt>native</tt> for <tt>mirror</tt>.</p>
<p>Even these more-specific properties are still shortcuts, and only work at the time of starting the Java VM. After the VM is running, these properties do not exist, setting them has no effect, and the only properties that matter are four even more specific ones that set the <tt>scalar</tt> and <tt>mirror</tt> byte ordering for both directions of conversion. What possible use that could have is the subject of the next section.</p>
<div class="section">
<h3><a name="Migration_of_existing_data"></a>Migration of existing data</h3>
<p>While there is no need for a migration step as long as the base type byte order remains big-endian, and there will be no change to that default until a future PL/Java release, workable migration approaches are covered here in advance.</p>
<p>A simple migration approach will be to do a (non-binary) dump (with PL/Java still configured for big-endian order), change PL/Java&#x2019;s configuration to use native order, and reload the data.</p>
<p>It is also possible, with a careful procedure and making use of the ability to set byte order independently for conversion from PostgreSQL to Java objects and the reverse direction, to do the migration with <tt>UPDATE</tt>. This method is covered on the <a href="byteordermigrate.html">byte-order migration page</a>.</p></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                    2003&#x2013;2020
                        <a href="http://tada.se/eng/">Tada AB</a>.
            All rights reserved.      
                    
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
